version: "3.3"
services:
  auth-adapter:
    image: auth-adapter
    build:
      dockerfile: Dockerfile
      context: auth-adapter
    environment:
      OTEL_ENABLE: false
      GRPC_GO_LOG_VERBOSITY_LEVEL: 99
      GRPC_GO_LOG_SEVERITY_LEVEL: debug
    volumes:
      - "./config.yaml:/opt/auth-adapter/config.yaml"
    ports:
      - "9000:9000"
    networks:
      private:
  api-gateway:
    build:
      dockerfile: Dockerfile
      context: launcher
    volumes:
      - "./config.yaml:/opt/auth-adapter/config.yaml"
      #- "./envoy.yaml:/etc/envoy/envoy.yaml"
#    entrypoint: "/usr/local/bin/envoy"
#    command: [ "-c /etc/envoy/envoy.yaml", "-l info" ]
    ports:
      - "8080:8080"
    environment:
      AUTH_ADAPTER_HOST: auth-adapter
    links:
      - web
      - health-demo
    networks:
      private:
  web:
    image: nicholasjackson/fake-service:v0.19.1
    environment:
      LISTEN_ADDR: 0.0.0.0:9091
      #UPSTREAM_URIS: "grpc://localhost:9092"
      MESSAGE: "Hello World"
      NAME: "web"
      SERVER_TYPE: "grpc"
    ports:
      - "9091:9091"
    networks:
      private:
  health-demo:
    image: demo-health
    build:
      dockerfile: Dockerfile
      context: ../tools/health-demo
    ports:
      - "8081:8081"
    networks:
      private:

networks:
  private:
    driver: bridge

